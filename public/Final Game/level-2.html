<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Level 2</title>
<style>
  .platform {
    position: absolute;
    background-color: #333;
  }
</style>
<script>
  // global variables here
  let myGlobalX = 0;
  let myClock;
  let myInterval = 0;
  let jumping = false;
  let gravity = 0.6;
  let vy = 0;
  let moveSpeed = 5;
  let jumpForce = -13;
  let moveLeft = false;
  let moveRight = false;
  let lastMoveDirection = 'right';
  let speedBoostTimeout = null;

let imgIdleLeft = "idleLeft.gif";
let imgIdleRight = "idleRight.gif";
let imgMovingLeft = "movingLeft.gif";
let imgMovingRight = "movingRight.gif";
let imgJumpingLeft = "jumpingLeft.png";
let imgJumpingRight = "jumpingRight.png";



  // global functions here
  function myHitOther(my1, my2) {
    left1   = parseInt(document.getElementById(my1).style.left)
   right1  = left1 + parseInt(document.getElementById(my1).style.width)
   top1    = parseInt(document.getElementById(my1).style.top)   
   bottom1 = top1   + parseInt(document.getElementById(my1).style.height)
   left2   = parseInt(document.getElementById(my2).style.left)
   right2  = left2 + parseInt(document.getElementById(my2).style.width)
   top2    = parseInt(document.getElementById(my2).style.top)   
   bottom2 = top2   + parseInt(document.getElementById(my2).style.height)
   if ((right1  >=  left2  ) &&      	   
       (bottom1 >=  top2   ) &&
       (left1   <=  right2 ) &&
       (top1    <=  bottom2) ){
       return true
   }
  }

  function myCheckHit() {
  if (myHitOther('myImg01', 'top')) {
    location = 'level-3.html';
  }

  if (myHitOther('myImg01', 'jumppad')) {
    jumpForce = -20;
  } else {
    jumpForce = -13;
  }

  if (myHitOther('myImg01', 'jumppad2')) {
    moveSpeed = 8;
    imgIdleLeft = "idleLeftRed.gif";
    imgIdleRight = "idleRightRed.gif";
    imgMovingLeft = "movingLeftRed.gif";
    imgMovingRight = "movingRightRed.gif";
    imgJumpingLeft = "jumpingLeftRed.png";
    imgJumpingRight = "jumpingRightRed.png";

    // clear the previous timeout
    if (speedBoostTimeout !== null) {
      clearTimeout(speedBoostTimeout);
    }

    // set a new timeout
    speedBoostTimeout = setTimeout(function () {
      moveSpeed = 5;
      imgIdleLeft = "idleLeft.gif";
      imgIdleRight = "idleRight.gif";
      imgMovingLeft = "movingLeft.gif";
      imgMovingRight = "movingRight.gif";
      imgJumpingLeft = "jumpingLeft.png";
      imgJumpingRight = "jumpingRight.png";
      speedBoostTimeout = null;
    }, 2000);
  }

  if (myHitOther('myImg01', 'jumppad3')) {
    moveSpeed = 8;
    imgIdleLeft = "idleLeftRed.gif";
    imgIdleRight = "idleRightRed.gif";
    imgMovingLeft = "movingLeftRed.gif";
    imgMovingRight = "movingRightRed.gif";
    imgJumpingLeft = "jumpingLeftRed.png";
    imgJumpingRight = "jumpingRightRed.png";

    // clear the previous timeout
    if (speedBoostTimeout !== null) {
      clearTimeout(speedBoostTimeout);
    }

    // set a new timeout
    speedBoostTimeout = setTimeout(function () {
      moveSpeed = 5;
      imgIdleLeft = "idleLeft.gif";
      imgIdleRight = "idleRight.gif";
      imgMovingLeft = "movingLeft.gif";
      imgMovingRight = "movingRight.gif";
      imgJumpingLeft = "jumpingLeft.png";
      imgJumpingRight = "jumpingRight.png";
      speedBoostTimeout = null;
    }, 2000);
  }
}
  let grounded = false;
  function gameLoop() {
  let player = document.getElementById("myImg01");

  if (moveLeft !== moveRight) {
    if (moveLeft) {
      player.style.left = parseInt(player.style.left) - moveSpeed + 'px';
    } else if (moveRight) {
      player.style.left = parseInt(player.style.left) + moveSpeed + 'px';
    }
  }

  vy += gravity;
  player.style.top = parseInt(player.style.top) + vy + "px";

  checkCollisions();

  updatePlayerImage();

  myCheckHit();

  requestAnimationFrame(gameLoop);
}



function checkCollisions() {
  let player = document.getElementById("myImg01");
  grounded = false;

  let platforms = ['platform1','platform2','platform3','platform4','platform5','platform6','platform7','platform8','platform9','platform10','platform11','platform12','platform13','platform14','platform15','platform16','platform17','platform18','platform19','platform20','platform21','platform22','platform23'];

  for (let i = 0; i < platforms.length; i++) {
    let platform = document.getElementById(platforms[i]);
    let platformLeft = parseInt(platform.style.left);
    let platformRight = platformLeft + parseInt(platform.style.width);
    let platformTop = parseInt(platform.style.top);
    let platformBottom = platformTop + parseInt(platform.style.height);

    let playerLeft = parseInt(player.style.left);
    let playerRight = playerLeft + parseInt(player.style.width);
    let playerTop = parseInt(player.style.top);
    let playerBottom = playerTop + parseInt(player.style.height);

    let horizontalCollision = playerRight >= platformLeft && playerLeft <= platformRight;
    let verticalCollision = playerBottom >= platformTop && playerTop <= platformBottom;

    if (horizontalCollision && verticalCollision) {
      let topOverlap = playerBottom - platformTop;
      let bottomOverlap = platformBottom - playerTop;
      let leftOverlap = playerRight - platformLeft;
      let rightOverlap = platformRight - playerLeft;

      let minOverlap = Math.min(topOverlap, bottomOverlap, leftOverlap, rightOverlap);

      if (minOverlap === topOverlap) {
        player.style.top = platformTop - parseInt(player.style.height) + 'px';
        vy = 0;
        jumping = false;
        grounded = true;
      } else if (minOverlap === bottomOverlap) {
        player.style.top = platformBottom + 'px';
        vy = 1;
      } else {
        if (minOverlap === leftOverlap) {
          player.style.left = platformLeft - parseInt(player.style.width) + 'px';
        } else if (minOverlap === rightOverlap) {
          player.style.left = platformRight + 'px';
        }
      }
    }
  }
}

let currentImage = '';

function updatePlayerImage() {
  let player = document.getElementById("myImg01");
  let newImage = '';

  if (jumping) {
    if (moveLeft || (!moveLeft && !moveRight && lastMoveDirection === 'left')) {
      newImage = imgJumpingLeft;
    } else if (moveRight || (!moveLeft && !moveRight && lastMoveDirection === 'right')) {
      newImage = imgJumpingRight;
    }
  } else {
    if (moveLeft) {
      newImage = imgMovingLeft;
    } else if (moveRight) {
      newImage = imgMovingRight;
    } else {
      if (lastMoveDirection === 'left') {
        newImage = imgIdleLeft;
      } else {
        newImage = imgIdleRight;
      }
    }
  }

  if (currentImage !== newImage) {
    player.src = newImage;
    currentImage = newImage;
  }
}


function handleKeydown(event) {
  let myKey = event.key;
  if (myKey === 'd') {
    moveRight = true;
    lastMoveDirection = 'right';
  } else if (myKey === 'a') {
    moveLeft = true;
    lastMoveDirection = 'left';
  } else if (myKey === ' ' && !jumping && grounded) {
    jumping = true;
    vy = jumpForce;
  }
}

function handleKeyup(event) {
  let myKey = event.key;
  if (myKey === 'd') {
    moveRight = false;
  } else if (myKey === 'a') {
    moveLeft = false;
  }
}

  window.addEventListener("keydown", handleKeydown);
  window.addEventListener("keyup", handleKeyup);
</script>
</head>
<body id="myBody" style="background-repeat:repeat; background-size: 100%" background="myBackground01.jpg" onload="{
  document.getElementById('myImg01').style.left = '600px';
  document.getElementById('myImg01').style.top = '650px';
  gameLoop();
}">

  <br><br><br><br>
  <div id="top" style="position: absolute; width:1600px; height:1px; top:0px; left:0px;"></div>
  <div id="platform1" class="platform" style="width:13px; height:757px; top:0px; left:0px;"></div>
  <div id="platform2" class="platform" style="width:13px; height:757px; top:0px; left:1587px;"></div>
  <div id="platform3" class="platform" style="width:534px; height:57px; top:700px; left:850px;"></div>
  <div id="platform4" class="platform" style="width:200px; height:13px; top:744px; left:585px;"></div>
  <div id="platform5" class="platform" style="width:1600px; height:1px; top:756px; left:0px;"></div>
  <div id="jumppad" style="position: absolute; background-color: rgb(77, 196, 77); width:100px; height:4px; top:699px; left:1100px;"></div>
  <div id="platform6" class="platform" style="width:150px; height:13px; top:430px; left:830px;"></div>
  <div id="platform7" class="platform" style="width:300px; height:13px; top:500px; left:525px;"></div>
  <div id="jumppad2" style="position: absolute; background-color: rgb(201, 70, 70); width:150px; height:4px; top:500px; left:600px;"></div>
  <div id="platform8" class="platform" style="width:180px; height:13px; top:550px; left:0px;"></div>
  <div id="platform9" class="platform" style="width:8px; height:13px; top:450px; left:1582px;"></div>
  <div id="platform10" class="platform" style="width:8px; height:13px; top:330px; left:1582px;"></div>
  <div id="platform11" class="platform" style="width:8px; height:13px; top:210px; left:1582px;"></div>
  <div id="platform12" class="platform" style="width:100px; height:13px; top:410px; left:0px;"></div>
  <div id="platform13" class="platform" style="width:120px; height:13px; top:280px; left:150px;"></div>
  <div id="platform14" class="platform" style="width:120px; height:13px; top:150px; left:300px;"></div>
  <div id="platform15" class="platform" style="width:200px; height:13px; top:200px; left:500px;"></div>
  <div id="platform16" class="platform" style="width:1250px; height:13px; top:0px; left:0px;"></div>
  <div id="platform17" class="platform" style="width:100px; height:13px; top:200px; left:775px;"></div>
  <div id="platform18" class="platform" style="width:600px; height:96px; top:13px; left:600px;"></div>
  <div id="platform19" class="platform" style="width:100px; height:13px; top:200px; left:950px;"></div>
  <div id="platform20" class="platform" style="width:300px; height:13px; top:200px; left:1125px;"></div>
  <div id="platform21" class="platform" style="width:270px; height:13px; top:0px; left:1320px;"></div>
  <div id="jumppad3" style="position: absolute; background-color: rgb(201, 70, 70); width:150px; height:4px; top:199px; left:530px;"></div>
  <div id="platform22" style="width:1px; height:80px; top:0px; left:1245px;"></div>
  <div id="platform23" style="width:1px; height:80px; top:0px; left:1325px;"></div>


  <img id="myTip02" style="position:absolute; width:336px; height:168px; top:550px; left:900px;" src="myTip02.gif">
  <img id="myImg01" style="position:absolute; width:50px; height:90px; top:650px; left:600px;" src="idleRight.png">
  <img id="myImg03" style="position:absolute; rotate: 180deg; width:80px; height:80px; top:0px; left:1245px;" src="pipe.png">
  <br><br>
</body>
</html>