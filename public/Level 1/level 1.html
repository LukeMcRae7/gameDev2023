<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Level 1</title>
<style>
  .platform {
    position: absolute;
    background-color: #333;
  }
</style>
<script>
  // global variables here
  let myGlobalX = 0;
  let myClock;
  let myInterval = 0;
  let jumping = false;
  let gravity = 0.6;
  let vy = 0;
  const moveSpeed = 7;
  const jumpForce = -15;
  let moveLeft = false;
  let moveRight = false;
  let lastMoveDirection = 'right';


const imgIdleLeft = "idleLeft.gif";
const imgIdleRight = "idleRight.gif";
const imgMovingLeft = "movingLeft.gif";
const imgMovingRight = "movingRight.gif";
const imgJumpingLeft = "jumpingLeft.png";
const imgJumpingRight = "jumpingRight.png";



  // global functions here
  function myHitOther(my1, my2) {
    left1   = parseInt(document.getElementById(my1).style.left)
   right1  = left1 + parseInt(document.getElementById(my1).style.width)
   top1    = parseInt(document.getElementById(my1).style.top)   
   bottom1 = top1   + parseInt(document.getElementById(my1).style.height)
   left2   = parseInt(document.getElementById(my2).style.left)
   right2  = left2 + parseInt(document.getElementById(my2).style.width)
   top2    = parseInt(document.getElementById(my2).style.top)   
   bottom2 = top2   + parseInt(document.getElementById(my2).style.height)
   if ((right1  >=  left2  ) &&      	   
       (bottom1 >=  top2   ) &&
       (left1   <=  right2 ) &&
       (top1    <=  bottom2) ){
       return true
   }
  }

  function myCheckHit() {
    if ( myHitOther('myImg01','myImg02') ){
       alert('you lose')  
       document.getElementById('myImg01').style.left = '20px'
       location = 't2a13-keydown.html'  // go to your next level
   }
  }
  let grounded = false;
  function gameLoop() {
  let player = document.getElementById("myImg01");

  if (moveLeft !== moveRight) {
    if (moveLeft) {
      player.style.left = parseInt(player.style.left) - moveSpeed + 'px';
    } else if (moveRight) {
      player.style.left = parseInt(player.style.left) + moveSpeed + 'px';
    }
  }

  vy += gravity;
  player.style.top = parseInt(player.style.top) + vy + "px";

  checkCollisions();

  updatePlayerImage();

  myCheckHit();

  requestAnimationFrame(gameLoop);
}



function checkCollisions() {
  let player = document.getElementById("myImg01");
  grounded = false;

  let platforms = ['platform1','platform2','platform3','platform4', 'platform5'];

  for (let i = 0; i < platforms.length; i++) {
    let platform = document.getElementById(platforms[i]);
    let platformLeft = parseInt(platform.style.left);
    let platformRight = platformLeft + parseInt(platform.style.width);
    let platformTop = parseInt(platform.style.top);
    let platformBottom = platformTop + parseInt(platform.style.height);

    let playerLeft = parseInt(player.style.left);
    let playerRight = playerLeft + parseInt(player.style.width);
    let playerTop = parseInt(player.style.top);
    let playerBottom = playerTop + parseInt(player.style.height);

    let horizontalCollision = playerRight >= platformLeft && playerLeft <= platformRight;
    let verticalCollision = playerBottom >= platformTop && playerTop <= platformBottom;

    if (horizontalCollision && verticalCollision) {
      let topOverlap = playerBottom - platformTop;
      let bottomOverlap = platformBottom - playerTop;
      let leftOverlap = playerRight - platformLeft;
      let rightOverlap = platformRight - playerLeft;

      let minOverlap = Math.min(topOverlap, bottomOverlap, leftOverlap, rightOverlap);

      if (minOverlap === topOverlap) {
        player.style.top = platformTop - parseInt(player.style.height) + 'px';
        vy = 0;
        jumping = false;
        grounded = true;
      } else if (minOverlap === bottomOverlap) {
        player.style.top = platformBottom + 'px';
        vy = 1;
      } else {
        if (minOverlap === leftOverlap) {
          player.style.left = platformLeft - parseInt(player.style.width) + 'px';
        } else if (minOverlap === rightOverlap) {
          player.style.left = platformRight + 'px';
        }
      }
    }
  }
}

let currentImage = '';

function updatePlayerImage() {
  let player = document.getElementById("myImg01");
  let newImage = '';

  if (jumping) {
    if (moveLeft || (!moveLeft && !moveRight && lastMoveDirection === 'left')) {
      newImage = imgJumpingLeft;
    } else if (moveRight || (!moveLeft && !moveRight && lastMoveDirection === 'right')) {
      newImage = imgJumpingRight;
    }
  } else {
    if (moveLeft) {
      newImage = imgMovingLeft;
    } else if (moveRight) {
      newImage = imgMovingRight;
    } else {
      if (lastMoveDirection === 'left') {
        newImage = imgIdleLeft;
      } else {
        newImage = imgIdleRight;
      }
    }
  }

  if (currentImage !== newImage) {
    player.src = newImage;
    currentImage = newImage;
  }
}


function handleKeydown(event) {
  let myKey = event.key;
  if (myKey === 'd') {
    moveRight = true;
    lastMoveDirection = 'right';
  } else if (myKey === 'a') {
    moveLeft = true;
    lastMoveDirection = 'left';
  } else if (myKey === ' ' && !jumping && grounded) {
    jumping = true;
    vy = jumpForce;
  }
}

function handleKeyup(event) {
  let myKey = event.key;
  if (myKey === 'd') {
    moveRight = false;
  } else if (myKey === 'a') {
    moveLeft = false;
  }
}

  window.addEventListener("keydown", handleKeydown);
  window.addEventListener("keyup", handleKeyup);
</script>
</head>
<body id="myBody" style="background-repeat:repeat; background-size: 80%" background="myBackground01.jpg" onload="{
  document.getElementById('myImg01').style.left = '400px';
  document.getElementById('myImg01').style.top = '0px';
  gameLoop();
}">

  <br><br><br><br>

  <img id="myImg01" style="position:absolute; width:75px; height:135px; top:0px; left:400px;" src="myImageIdleRight.png">
  <img id="myImg02" style="position:absolute; width:100px; height:80px; top:0px; left:250px;" src="myImage02.jpg">
  <div id="platform1" class="platform" style="width:20px; height:750px; top:0px; left:0px;"></div>
<div id="platform2" class="platform" style="width:20px; height:750px; top:0px; left:1550px;"></div>
<div id="platform3" class="platform" style="width:1570px; height:20px; top:750px; left:0px;"></div>
  <div id="platform4" class="platform" style="width:200px; height:20px; top:300px; left:100px;"></div>
<div id="platform5" class="platform" style="width:200px; height:20px; top:420px; left:300px;"></div>


 <!-- clearInterval(myClock);
  let myTemp =  myGlobalX + 'px 0px';
 document.getElementById('myBody').style.backgroundPosition = myTemp; !-->
  <br><br>
</body>
</html>
